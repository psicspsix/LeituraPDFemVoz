<!DOCTYPE html>

<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Leitor de PDF em Voz Alta</title>

    <style>

        body {

            font-family: Arial, sans-serif;

            margin: 20px;

            background-color: #000;

            color: #fff;

        }

        h1 {

            color: #fff;

        }

        .controls {

            margin: 20px 0;

        }

        .controls label {

            margin-right: 10px;

        }

        .controls input[type="range"] {

            width: 100px;

        }

        #conteudoPDF {

            margin-top: 20px;

            padding: 10px;

            border: 1px solid #444;

            background-color: #222;

            color: #fff;

            max-height: 300px;

            overflow-y: auto;

            line-height: 1.6;

            position: relative;

        }

        .highlight {

            background-color: yellow;

            color: black;

            padding: 2px 4px;

            border-radius: 3px;

        }

        button {

            background-color: #444;

            color: #fff;

            border: none;

            padding: 10px 15px;

            margin: 5px;

            cursor: pointer;

        }

        button:hover {

            background-color: #666;

        }

    </style>

</head>

<body>

    <h1>Leitor de PDF em Voz Alta</h1>



    <!-- Controles de volume e velocidade -->

    <div class="controls">

        <label for="volume">Volume:</label>

        <input type="range" id="volume" min="0" max="1" step="0.1" value="1">

        

        <label for="rate">Velocidade:</label>

        <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">

    </div>



    <!-- Botões de controle -->

    <button id="lerPDFFixo">Ler PDF Fixo em Voz Alta</button>

    <button id="pausarLeitura">Pausar</button>

    <button id="continuarLeitura">Continuar</button>



    <!-- Upload de PDF -->

    <input type="file" id="uploadPDF" accept="application/pdf">

    <button id="lerPDFUpload">Ler PDF Carregado em Voz Alta</button>



    <!-- Área para exibir o conteúdo do PDF -->

    <div id="conteudoPDF"></div>



    <!-- Scripts -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>

    <script>

        let utterance = null;

        let palavras = []; // Array para armazenar as palavras do texto

        let indiceAtual = 0; // Índice da palavra atual sendo lida

        let intervalo = null; // Intervalo para sincronizar a tarja



        // Função para extrair texto do PDF

        async function extractTextFromPDF(url) {

            const pdf = await pdfjsLib.getDocument(url).promise;

            let textoCompleto = '';



            for (let i = 1; i <= pdf.numPages; i++) {

                const page = await pdf.getPage(i);

                const textContent = await page.getTextContent();



                // Ajuste para preservar espaços entre palavras

                textoCompleto += textContent.items.map(item => {

                    return item.str + (item.hasEOL ? ' ' : '');

                }).join('');

            }



            return textoCompleto;

        }



        // Função para ler texto em voz alta

        function lerTexto(texto) {

            if (utterance) {

                speechSynthesis.cancel(); // Cancela a leitura atual, se houver

            }



            // Divide o texto em palavras

            palavras = texto.split(/\s+/);

            indiceAtual = 0;



            utterance = new SpeechSynthesisUtterance(texto);

            utterance.lang = 'pt-BR'; // Idioma português do Brasil

            utterance.volume = document.getElementById('volume').value;

            utterance.rate = document.getElementById('rate').value;



            // Atualiza volume e velocidade em tempo real

            document.getElementById('volume').addEventListener('input', () => {

                utterance.volume = document.getElementById('volume').value;

            });

            document.getElementById('rate').addEventListener('input', () => {

                utterance.rate = document.getElementById('rate').value;

            });



            // Inicia a leitura

            speechSynthesis.speak(utterance);



            // Sincroniza a tarja com a leitura

            if (intervalo) clearInterval(intervalo);

            intervalo = setInterval(() => {

                if (speechSynthesis.speaking && !speechSynthesis.paused) {

                    const tempoAtual = (speechSynthesis.paused) ? 0 : (window.speechSynthesis.currentTime || 0);

                    const palavrasLidas = Math.floor(tempoAtual * utterance.rate * 2); // Aproximação de palavras por segundo

                    if (palavrasLidas > indiceAtual) {

                        indiceAtual = palavrasLidas;



                        // Remove o destaque da palavra anterior

                        const palavrasElementos = document.querySelectorAll('#conteudoPDF .highlight');

                        palavrasElementos.forEach(palavra => palavra.classList.remove('highlight'));



                        // Destaca a palavra atual

                        const palavraAtual = document.getElementById(`palavra-${indiceAtual}`);

                        if (palavraAtual) {

                            palavraAtual.classList.add('highlight');

                            palavraAtual.scrollIntoView({ behavior: 'smooth', block: 'center' });

                        }

                    }

                } else if (!speechSynthesis.speaking) {

                    clearInterval(intervalo); // Para o intervalo quando a leitura termina

                }

            }, 100); // Verifica a cada 100ms

        }



        // Função para exibir o texto com IDs nas palavras

        function exibirTexto(texto) {

            const palavras = texto.split(/\s+/);

            const conteudoPDF = document.getElementById('conteudoPDF');

            conteudoPDF.innerHTML = palavras.map((palavra, index) => {

                return `<span id="palavra-${index}">${palavra}</span>`;

            }).join(' ');

        }



        // Ler PDF fixo

        document.getElementById('lerPDFFixo').addEventListener('click', async () => {

            const url = 'https://raw.githubusercontent.com/psicspsix/LeituraPDFemVoz/main/PDFparaLeituraemVoz.pdf';

            const texto = await extractTextFromPDF(url);

            exibirTexto(texto);

            lerTexto(texto);

        });



        // Ler PDF carregado

        document.getElementById('lerPDFUpload').addEventListener('click', async () => {

            const file = document.getElementById('uploadPDF').files[0];

            if (!file) {

                alert('Por favor, selecione um arquivo PDF.');

                return;

            }



            const fileReader = new FileReader();

            fileReader.onload = async function(event) {

                const url = event.target.result;

                const texto = await extractTextFromPDF(url);

                exibirTexto(texto);

                lerTexto(texto);

            };

            fileReader.readAsDataURL(file);

        });



        // Pausar leitura

        document.getElementById('pausarLeitura').addEventListener('click', () => {

            if (utterance && speechSynthesis.speaking) {

                speechSynthesis.pause();

            }

        });



        // Continuar leitura

        document.getElementById('continuarLeitura').addEventListener('click', () => {

            if (utterance && speechSynthesis.paused) {

                speechSynthesis.resume();

            }

        });

    </script>

</body>

</html>
